<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>input - The Graphix Programming Language</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Graphix Programming Language</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-input-widget"><a class="header" href="#the-input-widget">The Input Widget</a></h1>
<p>The <code>input_handler</code> widget intercepts terminal input events (keyboard, mouse, resize, etc.) and allows you to handle them before they reach child widgets. This is essential for creating interactive TUI applications with keyboard navigation, mouse interactions, and custom event handling.</p>
<h2 id="api"><a class="header" href="#api">API</a></h2>
<pre><code class="language-graphix">type Event = [
  `FocusGained,
  `FocusLost,
  `Key(KeyEvent),
  `Mouse(MouseEvent),
  `Paste(string),
  `Resize(i64, i64)
];

type KeyEvent = {
  code: KeyCode,
  kind: KeyEventKind,
  modifiers: Array&lt;KeyModifier&gt;,
  state: Array&lt;KeyEventState&gt;
};

type MouseEvent = {
  column: i64,
  kind: MouseEventKind,
  modifiers: Array&lt;KeyModifier&gt;,
  row: i64
};

/// Creates an input handler that intercepts events before they reach the child
val input_handler: fn(
    ?#enabled: &amp;[bool, null],
    #handle: &amp;fn(Event) -&gt; [`Stop, `Continue],
    &amp;Tui
) -&gt; Tui;
</code></pre>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<p>The <code>input_handler</code> widget sits between the terminal and your UI, intercepting all input events. Your handler function receives each event and returns either:</p>
<ul>
<li><strong>`Stop</strong>: Event was handled, don't pass it to child widgets</li>
<li><strong>`Continue</strong>: Event wasn't handled, pass it down to children</li>
</ul>
<p>This creates a hierarchical event system where parents can consume events before children see them, similar to event bubbling in web browsers.</p>
<h2 id="event-types"><a class="header" href="#event-types">Event Types</a></h2>
<h3 id="keyboard-events"><a class="header" href="#keyboard-events">Keyboard Events</a></h3>
<p>Keyboard events include the key code, event kind (press/release/repeat), active modifiers, and keyboard state:</p>
<pre><code class="language-graphix">type KeyCode = [
  `Backspace, `Enter, `Left, `Right, `Up, `Down,
  `Home, `End, `PageUp, `PageDown, `Tab, `BackTab,
  `Delete, `Insert, `Esc,
  `F(i64),              // Function keys: F(1), F(2), etc.
  `Char(string),        // Character input
  // ... and more
];

type KeyEventKind = [`Press, `Repeat, `Release];

type KeyModifier = [`Shift, `Control, `Alt, `Super, `Hyper, `Meta];
</code></pre>
<h3 id="mouse-events"><a class="header" href="#mouse-events">Mouse Events</a></h3>
<p>Mouse events include position (row/column), event kind, and modifiers:</p>
<pre><code class="language-graphix">type MouseEventKind = [
  `Down(MouseButton),
  `Up(MouseButton),
  `Drag(MouseButton),
  `Moved,
  `ScrollDown, `ScrollUp,
  `ScrollLeft, `ScrollRight
];

type MouseButton = [`Left, `Right, `Middle];
</code></pre>
<h3 id="other-events"><a class="header" href="#other-events">Other Events</a></h3>
<ul>
<li><strong><code>FocusGained</code>/<code>FocusLost</code></strong>: Terminal window focus changes</li>
<li><strong><code>Paste(string)</code></strong>: Text pasted into terminal</li>
<li><strong><code>Resize(i64, i64)</code></strong>: Terminal window resized (width, height)</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="basic-keyboard-navigation"><a class="header" href="#basic-keyboard-navigation">Basic Keyboard Navigation</a></h3>
<pre><code class="language-graphix">use tui;
use tui::list;
use tui::block;
use tui::text;
use tui::input_handler;

let items = [
    line("Apple"), line("Banana"), line("Cherry"),
    line("Date"), line("Elderberry"), line("Fig"), line("Grape")
];

let last = array::len(items) - 1;
let selected = 0;
let scroll_pos = 0;
let visible = 5;

// Auto-scroll to keep selection visible
scroll_pos &lt;- select selected {
    s if s &lt; scroll_pos =&gt; s,
    s if s &gt; (scroll_pos + visible - 1) =&gt; s - visible + 1,
    _ =&gt; never()
};

let handle_event = |e: Event| -&gt; [`Stop, `Continue] select e {
    `Key(k) =&gt; select k.kind {
        `Press =&gt; select k.code {
            k@`Up if selected &gt; 0 =&gt; {
                selected &lt;- (k ~ selected) - 1;
                `Stop
            },
            k@`Down if selected &lt; last =&gt; {
                selected &lt;- (k ~ selected) + 1;
                `Stop
            },
            k@`Home =&gt; { selected &lt;- k ~ 0; `Stop },
            k@`End =&gt; { selected &lt;- k ~ last; `Stop },
            _ =&gt; `Continue
        },
        _ =&gt; `Continue
    },
    _ =&gt; `Continue
};

input_handler(
    #handle: &amp;handle_event,
    &amp;block(
        #border: &amp;`All,
        #title: &amp;line("Fruit Selection"),
        &amp;list(
            #highlight_style: &amp;style(#fg: `Black, #bg: `Yellow),
            #highlight_symbol: &amp;"▶ ",
            #selected: &amp;selected,
            #scroll: &amp;scroll_pos,
            &amp;items
        )
    )
)
</code></pre>
<p>This example shows keyboard navigation in a list. Arrow keys move the selection, and the viewport automatically scrolls to keep the selection visible.</p>
<p><img src="./media/list_interactive.gif" alt="Interactive List" /></p>
<h3 id="focus-management"><a class="header" href="#focus-management">Focus Management</a></h3>
<pre><code class="language-graphix">use tui;
use tui::layout;
use tui::text;
use tui::input_handler;
use tui::block;

let focused = 0;

let handle_event = |e: Event| -&gt; [`Stop, `Continue] select e {
    `Key(k) =&gt; select k.kind {
        `Press =&gt; select k.code {
            k@`Tab =&gt; {
                focused &lt;- ((k ~ focused) + 1) % 3;
                `Stop
            },
            _ =&gt; `Continue
        },
        _ =&gt; `Continue
    },
    _ =&gt; `Continue
};

let focused_border = |i| select focused { n if n == i =&gt; `All, _ =&gt; [`Top] };
let left_pane = block(#border:&amp;focused_border(0), &amp;text(&amp;"Left"));
let center_pane = block(#border:&amp;focused_border(1), &amp;text(&amp;"Center"));
let right_pane = block(#border:&amp;focused_border(2), &amp;text(&amp;"Right"));

input_handler(
    #handle: &amp;handle_event,
    &amp;layout(
        #direction: &amp;`Horizontal,
        #focused: &amp;focused,
        &amp;[
            child(#constraint: `Percentage(25), left_pane),
            child(#constraint: `Percentage(50), center_pane),
            child(#constraint: `Percentage(25), right_pane)
        ]
    )
)
</code></pre>
<p>Tab cycles focus between three panes, with visual feedback via border styling.</p>
<p><img src="./media/layout_focus.gif" alt="Layout Focus" /></p>
<h3 id="scrollable-content"><a class="header" href="#scrollable-content">Scrollable Content</a></h3>
<pre><code class="language-graphix">use tui;
use tui::scrollbar;
use tui::paragraph;
use tui::block;
use tui::text;
use tui::input_handler;

let long_text = "Very long text content...";
let position = 0;
let max_position = 100;

let handle_event = |e: Event| -&gt; [`Stop, `Continue] select e {
    `Key(k) =&gt; select k.kind {
        `Press =&gt; select k.code {
            k@`Up if position &gt; 0 =&gt; {
                position &lt;- (k ~ position) - 1;
                `Stop
            },
            k@`Down if position &lt; max_position =&gt; {
                position &lt;- (k ~ position) + 1;
                `Stop
            },
            k@`PageUp if position &gt; 10 =&gt; {
                position &lt;- (k ~ position) - 10;
                `Stop
            },
            k@`PageDown if position &lt; (max_position - 10) =&gt; {
                position &lt;- (k ~ position) + 10;
                `Stop
            },
            k@`Home =&gt; { position &lt;- k ~ 0; `Stop },
            k@`End =&gt; { position &lt;- k ~ max_position; `Stop },
            _ =&gt; `Continue
        },
        _ =&gt; `Continue
    },
    _ =&gt; `Continue
};

input_handler(
    #handle: &amp;handle_event,
    &amp;block(
        #border: &amp;`All,
        #title: &amp;line("Scrollable Content"),
        &amp;scrollbar(
            #position: &amp;position,
            #content_length: &amp;max_position,
            &amp;paragraph(#scroll: &amp;{x: 0, y: position}, &amp;long_text)
        )
    )
)
</code></pre>
<p>Arrow keys and page up/down navigate through long text content.</p>
<p><img src="./media/scroll_paragraph.gif" alt="Scrollable Paragraph" /></p>
<h2 id="event-handler-pattern"><a class="header" href="#event-handler-pattern">Event Handler Pattern</a></h2>
<p>A typical event handler uses nested <code>select</code> expressions to pattern match on event types:</p>
<pre><code class="language-graphix">let handle_event = |e: Event| -&gt; [`Stop, `Continue] select e {
    `Key(k) =&gt; select k.kind {
        `Press =&gt; select k.code {
            k@`Up if condition =&gt; {
                // Handle up arrow
                `Stop
            },
            k@`Down if condition =&gt; {
                // Handle down arrow
                `Stop
            },
            _ =&gt; `Continue  // Pass unhandled keys to children
        },
        _ =&gt; `Continue
    },
    `Mouse(m) =&gt; select m.kind {
        // Handle mouse events
        _ =&gt; `Continue
    },
    _ =&gt; `Continue  // Pass other events through
};
</code></pre>
<p>The <code>k@</code> syntax binds the key event to <code>k</code>, allowing you to access it within the handler while the event flows through the reactive graph.</p>
<h2 id="disabling-input"><a class="header" href="#disabling-input">Disabling Input</a></h2>
<p>Use the optional <code>enabled</code> parameter to temporarily disable event handling:</p>
<pre><code class="language-graphix">let input_enabled = true;

input_handler(
    #enabled: &amp;input_enabled,
    #handle: &amp;handle_event,
    &amp;child_widget
)
</code></pre>
<p>When <code>enabled</code> is <code>false</code> or <code>null</code>, events pass through without calling the handler.</p>
<h2 id="nesting-input-handlers"><a class="header" href="#nesting-input-handlers">Nesting Input Handlers</a></h2>
<p>Input handlers can be nested to create hierarchical event handling:</p>
<pre><code class="language-graphix">input_handler(
    #handle: &amp;global_handler,  // Handles global shortcuts
    &amp;layout([
        input_handler(
            #handle: &amp;left_pane_handler,  // Handles left pane input
            &amp;left_widget
        ),
        input_handler(
            #handle: &amp;right_pane_handler,  // Handles right pane input
            &amp;right_widget
        )
    ])
)
</code></pre>
<p>Parents process events first. If they return <code>Continue</code>, the event flows down to children.</p>
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="arrow-key-navigation"><a class="header" href="#arrow-key-navigation">Arrow Key Navigation</a></h3>
<pre><code class="language-graphix">select k.code {
    k@`Up if index &gt; 0 =&gt; {
        index &lt;- (k ~ index) - 1;
        `Stop
    },
    k@`Down if index &lt; max =&gt; {
        index &lt;- (k ~ index) + 1;
        `Stop
    },
    _ =&gt; `Continue
}
</code></pre>
<h3 id="modal-keybindings"><a class="header" href="#modal-keybindings">Modal Keybindings</a></h3>
<pre><code class="language-graphix">let mode = `Normal;

select k.code {
    k@`Char("i") if mode == `Normal =&gt; {
        mode &lt;- k ~ `Insert;
        `Stop
    },
    k@`Esc if mode == `Insert =&gt; {
        mode &lt;- k ~ `Normal;
        `Stop
    },
    _ =&gt; `Continue
}
</code></pre>
<h3 id="modifier-keys"><a class="header" href="#modifier-keys">Modifier Keys</a></h3>
<pre><code class="language-graphix">select e {
    `Key(k) =&gt; {
        let has_ctrl = array::member(k.modifiers, `Control);
        select k.code {
            k@`Char("c") if has_ctrl =&gt; {
                // Handle Ctrl+C
                `Stop
            },
            _ =&gt; `Continue
        }
    },
    _ =&gt; `Continue
}
</code></pre>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="layout.html">layout</a> - Focus management with layouts</li>
<li><a href="list.html">list</a> - Interactive list widget</li>
<li><a href="table.html">table</a> - Interactive table widget</li>
<li><a href="scroll.html">scroll</a> - Scrollbar widget for scrollable content</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ui/tui/linegauge.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ui/tui/layout.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ui/tui/linegauge.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ui/tui/layout.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/graphix-highlight.js"></script>



    </div>
    </body>
</html>
